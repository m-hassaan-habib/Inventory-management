<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 384 512'%3E%3Cpath fill='%2363E6BE' d='M288 256H96v64h192v-64zm89-151L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-153 31V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zM64 72c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8V72zm0 64c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8v-16zm256 304c0 4.42-3.58 8-8 8h-80c-4.42 0-8-3.58-8-8v-16c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16zm0-200v96c0 8.84-7.16 16-16 16H80c-8.84 0-16-7.16-16-16v-96c0-8.84 7.16-16 16-16h224c8.84 0 16 7.16 16 16z'/%3E%3C/svg%3E">

  <title>InvoiceFlow</title>

  <script>
    (function () {
      try {
        const stored = localStorage.getItem("theme");
        const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
        const shouldDark = stored ? (stored === "dark") : prefersDark;
        if (shouldDark) document.documentElement.classList.add("dark");
      } catch (_) {}
    })();
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: "class" };
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: "Inter", sans-serif; }
  </style>
</head>

<body class="bg-white text-slate-900 dark:bg-[#1d1d1d] dark:text-slate-100">
  <!-- Remove the max-width wrapper that causes “empty space” behavior on wide screens -->
  <div class="min-h-screen md:flex">
    <!-- Mobile top bar (shows on < md) -->
    <header class="md:hidden flex items-center justify-between p-4 bg-white border-b border-gray-300 dark:bg-[#161616] dark:border-white/10">
      <a href="{{ url_for('dashboard.dashboard') }}" class="flex items-center gap-3 min-w-0">
        <div class="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center shrink-0">
          <i class="fas fa-file-invoice text-white text-sm"></i>
        </div>
        <div class="leading-tight min-w-0">
          <div class="text-sm font-semibold text-slate-900 dark:text-white truncate">InvoiceFlow</div>
          <div class="text-xs text-slate-500 dark:text-white/60 truncate">Invoice Management</div>
        </div>
      </a>

      <div class="flex items-center gap-2">
        <button
          id="themeToggleMobile"
          type="button"
          class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-slate-200 text-slate-700 hover:bg-slate-50
                 dark:border-white/10 dark:text-white/80 dark:hover:bg-white/5"
          aria-label="Toggle dark mode"
        >
          <i id="themeIconMobile" class="fas fa-moon text-sm"></i>
        </button>

        <button
          id="sidebarOpen"
          type="button"
          class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-slate-200 text-slate-700 hover:bg-slate-50
                 dark:border-white/10 dark:text-white/80 dark:hover:bg-white/5"
          aria-label="Open menu"
        >
          <i class="fas fa-bars text-sm"></i>
        </button>
      </div>
    </header>

    <!-- Mobile sidebar drawer -->
    <div id="sidebarOverlay" class="fixed inset-0 z-50 hidden md:hidden">
      <button id="sidebarClose" class="absolute inset-0 bg-black/40" aria-label="Close menu"></button>

      <aside class="relative h-full w-72 bg-white border-r border-gray-300 dark:bg-[#161616] dark:border-white/10 p-4 flex flex-col">
        <div class="flex items-start justify-between gap-3">
          <a href="{{ url_for('dashboard.dashboard') }}" class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center shrink-0">
              <i class="fas fa-file-invoice text-white text-sm"></i>
            </div>
            <div class="leading-tight">
              <h1 class="text-sm font-semibold text-slate-900 dark:text-white">InvoiceFlow</h1>
              <p class="text-xs text-slate-500 dark:text-white/60">Invoice Management</p>
            </div>
          </a>

          <button
            id="themeToggleDrawer"
            type="button"
            class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-slate-200 text-slate-700 hover:bg-slate-50
                   dark:border-white/10 dark:text-white/80 dark:hover:bg-white/5"
            aria-label="Toggle dark mode"
          >
            <i id="themeIconDrawer" class="fas fa-moon text-sm"></i>
          </button>
        </div>

        <nav class="mt-6 flex-1 overflow-y-auto flex flex-col gap-2 text-sm text-gray-700 dark:text-white/75">
          <a href="{{ url_for('dashboard.dashboard') }}"
             class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
             {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'dashboard.dashboard' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
            <i class="fas fa-home text-[14px] w-4"></i>
            <span class="{{ 'font-semibold' if request.endpoint == 'dashboard.dashboard' else '' }}">Dashboard</span>
          </a>

          <a href="{{ url_for('vendors.list_vendors') }}"
             class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
             {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'vendors.list_vendors' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
            <i class="fas fa-users text-[14px] w-4"></i>
            <span class="{{ 'font-semibold' if request.endpoint == 'vendors.list_vendors' else '' }}">Vendors</span>
          </a>

          <a href="{{ url_for('products.list_products') }}"
             class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
             {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'products.list_products' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
            <i class="fas fa-box-open text-[14px] w-4"></i>
            <span class="{{ 'font-semibold' if request.endpoint == 'products.list_products' else '' }}">Products</span>
          </a>

          <a href="{{ url_for('invoices.list_invoices') }}"
             class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
             {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'invoices.list_invoices' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
            <i class="fas fa-file-invoice-dollar text-[14px] w-4"></i>
            <span class="{{ 'font-semibold' if request.endpoint == 'invoices.list_invoices' else '' }}">Invoices</span>
          </a>

          <a href="{{ url_for('reports.reports') }}"
             class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
             {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'reports.reports' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
            <i class="fas fa-chart-bar text-[14px] w-4"></i>
            <span class="{{ 'font-semibold' if request.endpoint == 'reports.reports' else '' }}">Reports</span>
          </a>
        </nav>
      </aside>
    </div>

    <!-- Desktop sidebar (shows on md+) -->
    <aside class="hidden md:flex md:w-56 bg-white border-r border-gray-300 dark:bg-[#161616] dark:border-white/10 p-4 flex-col md:h-screen md:sticky md:top-0">
      <div class="flex items-start justify-between gap-3">
        <a href="{{ url_for('dashboard.dashboard') }}" class="flex items-center gap-3">
          <div class="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center shrink-0">
            <i class="fas fa-file-invoice text-white text-sm"></i>
          </div>
          <div class="leading-tight">
            <h1 class="text-sm font-semibold text-slate-900 dark:text-white">InvoiceFlow</h1>
            <p class="text-xs text-slate-500 dark:text-white/60">Invoice Management</p>
          </div>
        </a>

        <button
          id="themeToggle"
          type="button"
          class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-slate-200 text-slate-700 hover:bg-slate-50
                 dark:border-white/10 dark:text-white/80 dark:hover:bg-white/5"
          aria-label="Toggle dark mode"
        >
          <i id="themeIcon" class="fas fa-moon text-sm"></i>
        </button>
      </div>

      <nav class="mt-6 flex-1 overflow-y-auto flex flex-col gap-2 text-sm text-gray-700 dark:text-white/75">
        <a href="{{ url_for('dashboard.dashboard') }}"
           class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
           {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'dashboard.dashboard' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
          <i class="fas fa-home text-[14px] w-4"></i>
          <span class="{{ 'font-semibold' if request.endpoint == 'dashboard.dashboard' else '' }}">Dashboard</span>
        </a>

        <a href="{{ url_for('vendors.list_vendors') }}"
           class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
           {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'vendors.list_vendors' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
          <i class="fas fa-users text-[14px] w-4"></i>
          <span class="{{ 'font-semibold' if request.endpoint == 'vendors.list_vendors' else '' }}">Vendors</span>
        </a>

        <a href="{{ url_for('products.list_products') }}"
           class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
           {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'products.list_products' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
          <i class="fas fa-box-open text-[14px] w-4"></i>
          <span class="{{ 'font-semibold' if request.endpoint == 'products.list_products' else '' }}">Products</span>
        </a>

        <a href="{{ url_for('invoices.list_invoices') }}"
           class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
           {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'invoices.list_invoices' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
          <i class="fas fa-file-invoice-dollar text-[14px] w-4"></i>
          <span class="{{ 'font-semibold' if request.endpoint == 'invoices.list_invoices' else '' }}">Invoices</span>
        </a>

        <a href="{{ url_for('reports.reports') }}"
           class="flex items-center gap-2 hover:text-gray-900 dark:hover:text-white
           {{ 'text-indigo-600 border border-indigo-600 rounded-md px-3 py-2 dark:text-indigo-300 dark:border-indigo-400/70 dark:bg-white/5' if request.endpoint == 'reports.reports' else 'px-3 py-2 rounded-md hover:bg-slate-50 dark:hover:bg-white/5' }}">
          <i class="fas fa-chart-bar text-[14px] w-4"></i>
          <span class="{{ 'font-semibold' if request.endpoint == 'reports.reports' else '' }}">Reports</span>
        </a>
      </nav>
    </aside>

    <!-- Main -->
    <main class="flex-1 min-w-0 bg-white p-6 md:p-8 space-y-6 dark:bg-[#1d1d1d]">
      <header class="flex items-center gap-2 text-gray-900 font-semibold text-sm border-b border-gray-300 pb-3 dark:text-white dark:border-white/10">
        <i class="fas fa-file-invoice-dollar text-base"></i>
        <h2>Invoice Management System</h2>
      </header>

      {% block content %}{% endblock %}
    </main>
  </div>

  <script>
    (function () {
      const root = document.documentElement;

      const btnDesktop = document.getElementById("themeToggle");
      const iconDesktop = document.getElementById("themeIcon");

      const btnMobile = document.getElementById("themeToggleMobile");
      const iconMobile = document.getElementById("themeIconMobile");

      const btnDrawer = document.getElementById("themeToggleDrawer");
      const iconDrawer = document.getElementById("themeIconDrawer");

      function setTheme(isDark) {
        root.classList.toggle("dark", isDark);
        try { localStorage.setItem("theme", isDark ? "dark" : "light"); } catch (_) {}
        syncIcons();
      }

      function isDark() {
        return root.classList.contains("dark");
      }

      function syncIcons() {
        const cls = isDark() ? "fas fa-sun text-sm" : "fas fa-moon text-sm";
        if (iconDesktop) iconDesktop.className = cls;
        if (iconMobile) iconMobile.className = cls;
        if (iconDrawer) iconDrawer.className = cls;
      }

      syncIcons();

      function wire(btn) {
        if (!btn) return;
        btn.addEventListener("click", () => setTheme(!isDark()));
      }

      wire(btnDesktop);
      wire(btnMobile);
      wire(btnDrawer);

      // Drawer open/close
      const openBtn = document.getElementById("sidebarOpen");
      const closeBtn = document.getElementById("sidebarClose");
      const overlay = document.getElementById("sidebarOverlay");

      function openSidebar() {
        if (!overlay) return;
        overlay.classList.remove("hidden");
        root.classList.add("overflow-hidden");
      }

      function closeSidebar() {
        if (!overlay) return;
        overlay.classList.add("hidden");
        root.classList.remove("overflow-hidden");
      }

      if (openBtn) openBtn.addEventListener("click", openSidebar);
      if (closeBtn) closeBtn.addEventListener("click", closeSidebar);

      // Close drawer on ESC
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeSidebar();
      });
    })();
  </script>
</body>
</html>
