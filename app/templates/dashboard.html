{% extends "base.html" %}
{% block content %}
<div class="flex-1 overflow-y-auto p-6">

  <section class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-6">
    <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition-shadow duration-100 transform hover:-translate-y-2 dark:bg-[#202020] dark:border-white/10">
      <p class="text-xs text-gray-500 mb-1 dark:text-white/60">Total Expenses</p>
      <div class="flex items-center justify-between">
        <span class="font-extrabold text-lg text-gray-900 dark:text-white">Rs.{{ "{:,.2f}".format(total_expenses) }}</span>
        <i class="fas fa-dollar-sign text-green-500 text-sm"></i>
      </div>
      {% if revenue_mom_pct is not none %}
        <p class="text-xs text-gray-400 mt-1 dark:text-white/50">{{ "+" if revenue_mom_pct >= 0 else "" }}{{ revenue_mom_pct }}% from last month</p>
      {% else %}
        <p class="text-xs text-gray-400 mt-1 dark:text-white/50">No last-month baseline</p>
      {% endif %}
    </div>

    <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition-shadow duration-100 transform hover:-translate-y-2 dark:bg-[#202020] dark:border-white/10">
      <p class="text-xs text-gray-500 mb-1 dark:text-white/60">Total Invoices</p>
      <div class="flex items-center justify-between">
        <span class="font-extrabold text-lg text-gray-900 dark:text-white">{{ total_invoices }}</span>
        <i class="fas fa-file-alt text-indigo-600 text-sm"></i>
      </div>
      {% if invoices_mom_pct is not none %}
        <p class="text-xs text-gray-400 mt-1 dark:text-white/50">{{ "+" if invoices_mom_pct >= 0 else "" }}{{ invoices_mom_pct }}% from last month</p>
      {% else %}
        <p class="text-xs text-gray-400 mt-1 dark:text-white/50">No last-month baseline</p>
      {% endif %}
    </div>

    <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition-shadow duration-100 transform hover:-translate-y-2 dark:bg-[#202020] dark:border-white/10">
      <p class="text-xs text-gray-500 mb-1 dark:text-white/60">Active Vendors</p>
      <div class="flex items-center justify-between">
        <span class="font-extrabold text-lg text-gray-900 dark:text-white">{{ total_vendors }}</span>
        <i class="fas fa-building text-yellow-400 text-sm"></i>
      </div>
      <p class="text-xs text-gray-400 mt-1 dark:text-white/50">Updated in realtime</p>
    </div>

    <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition-shadow duration-100 transform hover:-translate-y-2 dark:bg-[#202020] dark:border-white/10">
      <p class="text-xs text-gray-500 mb-1 dark:text-white/60">Products</p>
      <div class="flex items-center justify-between">
        <span class="font-extrabold text-lg text-gray-900 dark:text-white">{{ total_products }}</span>
        <i class="fas fa-cube text-green-500 text-sm"></i>
      </div>
      <p class="text-xs text-gray-400 mt-1 dark:text-white/50">Updated in realtime</p>
    </div>
  </section>

  <section class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow duration-100 dark:bg-[#202020] dark:border-white/10">
      <h3 class="font-semibold text-gray-900 text-lg mb-4 flex items-center gap-2 dark:text-white">
        <i class="fas fa-chart-bar text-indigo-600"></i>
        Revenue Overview
      </h3>
      <div class="h-48">
        <canvas id="revenueChart"></canvas>
      </div>
    </div>

    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow duration-100 dark:bg-[#202020] dark:border-white/10">
      <h3 class="font-semibold text-gray-900 text-lg mb-4 flex items-center gap-2 dark:text-white">
        <i class="fas fa-chart-pie text-indigo-600"></i>
        Invoice Status Distribution
      </h3>
      <div class="h-48">
        <canvas id="statusChart"></canvas>
      </div>
    </div>
  </section>

  <section class="grid grid-cols-1 sm:grid-cols-3 md:grid-cols-3 gap-6 mb-6">
    <div class="md:col-span-2 bg-white border border-gray-200 rounded-lg p-6 flex flex-col shadow-sm hover:shadow-md transition-shadow duration-100 dark:bg-[#202020] dark:border-white/10">
      <h3 class="font-semibold text-gray-900 text-lg mb-4 flex items-center gap-2 dark:text-white">
        <i class="fas fa-file-alt text-indigo-600"></i>
        Recent Invoices
      </h3>
      <div class="flex flex-col space-y-4 text-xs text-gray-700 dark:text-white/70">
        {% for inv in recent_invoices %}
        <div class="flex justify-between items-center p-2 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors duration-100 dark:border-white/10 dark:hover:bg-white/5">
          <div>
            <p class="font-semibold text-sm text-gray-900 leading-tight dark:text-white">{{ inv.invoice_number }}</p>
            <p class="text-xs text-gray-500 dark:text-white/60">{{ inv.vendor_name }}</p>
          </div>
          <div class="flex items-center space-x-2">
            <p class="font-semibold text-sm text-gray-900 dark:text-white">Rs.{{ "{:,.2f}".format(inv.total) }}</p>
            <span class="{% if inv.status == 'Paid' %}bg-green-100 text-green-600 dark:bg-green-500/15 dark:text-green-300{% elif inv.status == 'Pending' %}bg-yellow-100 text-yellow-600 dark:bg-yellow-500/15 dark:text-yellow-300{% else %}bg-red-100 text-red-600 dark:bg-red-500/15 dark:text-red-300{% endif %} text-[9px] font-semibold px-2 py-0.5 rounded-full select-none">
              {{ inv.status|lower }}
            </span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col shadow-sm hover:shadow-md transition-shadow duration-100 dark:bg-[#202020] dark:border-white/10">
      <h3 class="font-semibold text-gray-900 text-lg mb-4 flex items-center gap-2 dark:text-white">
        <i class="fas fa-chart-line text-indigo-600"></i>
        Quick Actions
      </h3>
      <div class="flex flex-col space-y-3">
        <button onclick="openVendorModal()" class="flex items-center space-x-3 rounded-lg border border-gray-200 p-3 text-left hover:bg-gray-50 transition-colors duration-100 transform hover:scale-[1.02] dark:border-white/10 dark:hover:bg-white/5" type="button">
          <div class="w-8 h-8 rounded-md bg-green-100 text-green-600 flex items-center justify-center dark:bg-green-500/15 dark:text-green-300">
            <i class="fas fa-building text-sm"></i>
          </div>
          <div class="text-xs">
            <p class="font-semibold text-gray-900 leading-tight dark:text-white">Add New Vendor</p>
            <p class="text-gray-500 dark:text-white/60">Register a new vendor</p>
          </div>
        </button>
        <button onclick="openProductModal()" class="flex items-center space-x-3 rounded-lg border border-gray-200 p-3 text-left hover:bg-gray-50 transition-colors duration-100 transform hover:scale-[1.02] dark:border-white/10 dark:hover:bg-white/5" type="button">
          <div class="w-8 h-8 rounded-md bg-yellow-100 text-yellow-600 flex items-center justify-center dark:bg-yellow-500/15 dark:text-yellow-300">
            <i class="fas fa-cube text-sm"></i>
          </div>
          <div class="text-xs">
            <p class="font-semibold text-gray-900 leading-tight dark:text-white">Add New Product</p>
            <p class="text-gray-500 dark:text-white/60">Add a product to catalog</p>
          </div>
        </button>
      </div>
    </div>
  </section>

</div>

{% include "modals/add_vendor.html" %}
{% include "modals/add_product.html" %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const isDark = document.documentElement.classList.contains('dark');

const palette = ["#756ceb", "#aba5f3", "#cfcaf8", "#f0eefe", "#f8f6ff"];

const revenueLabels = {{ revenue_labels|tojson }};
const revenueValues = {{ revenue_values|tojson }};
const statusLabels = {{ status_labels|tojson }};
const statusValues = {{ status_values|tojson }};

const axisTickColor = isDark ? "rgba(255,255,255,0.65)" : "#6b7280";
const gridColor = isDark ? "rgba(255,255,255,0.08)" : "#e5e7eb";

const revenueCtx = document.getElementById('revenueChart').getContext('2d');
const gradient = revenueCtx.createLinearGradient(0, 0, 0, 300);
gradient.addColorStop(0, "rgba(99, 89, 232, 0.80)");
gradient.addColorStop(1, "rgba(248, 246, 255, 0)");

new Chart(revenueCtx, {
  type: 'line',
  data: {
    labels: revenueLabels,
    datasets: [{
      data: revenueValues,
      borderColor: '#6359e8',
      backgroundColor: gradient,
      fill: true,
      tension: 0.5,
      pointRadius: 3,
      pointBackgroundColor: '#f0eefe'
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
      tooltip: {
        backgroundColor: '#6359e8',
        titleColor: '#fff',
        bodyColor: '#fff'
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: { color: axisTickColor, font: { size: 11 } },
        grid: { color: gridColor }
      },
      x: {
        ticks: { color: axisTickColor, font: { size: 11 } },
        grid: { display: false }
      }
    }
  }
});

const statusCtx = document.getElementById('statusChart').getContext('2d');
new Chart(statusCtx, {
  type: 'doughnut',
  data: {
    labels: statusLabels,
    datasets: [{
      data: statusValues,
      backgroundColor: palette.slice(0, 3),
      borderWidth: 0
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    cutout: '65%',
    plugins: {
      legend: {
        position: 'bottom',
        labels: { color: axisTickColor, font: { size: 11 } }
      },
      tooltip: {
        backgroundColor: '#6359e8',
        titleColor: '#fff',
        bodyColor: '#fff'
      }
    }
  }
});
</script>
{% endblock %}
